# NSURLSession

![image-20211106104138074](%E7%AC%94%E8%AE%B0.assets/image-20211106104138074.png)

- connection运行在当前线程的消息循环中（太底层

想要在子线程运行要把代理设在子线程上，还要专门开启子线程的消息循环

- **Session默认子线程**

- Connection 面向请求 响应

Session 面向任务

## DataTask

![image-20211106105547204](%E7%AC%94%E8%AE%B0.assets/image-20211106105547204.png)

- 默认get请求

## DownloadTask

默认下载到temp，下载完毕自动删除

![image-20211106115209612](%E7%AC%94%E8%AE%B0.assets/image-20211106115209612.png)

- 默认在子线程

- 会自动控制内存 不暴涨

### 下载进度

![image-20211106115400088](%E7%AC%94%E8%AE%B0.assets/image-20211106115400088.png)

![image-20211106222545949](%E7%AC%94%E8%AE%B0.assets/image-20211106222545949.png)

# 压缩/解压缩

![image-20211106223439172](%E7%AC%94%E8%AE%B0.assets/image-20211106223439172.png)

![image-20211106224002410](%E7%AC%94%E8%AE%B0.assets/image-20211106224002410.png)

# WebDav

- 建立在http协议基础上的服务器（文件的服务器

![image-20211107114511618](%E7%AC%94%E8%AE%B0.assets/image-20211107114511618.png)

![image-20211107121439195](%E7%AC%94%E8%AE%B0.assets/image-20211107121439195.png)

上传，删除都需要账户信息

request.HTTPMethod = @"put";来上传

删除：request.HTTPMethod = @"delete";
![image-20211107230505637](%E7%AC%94%E8%AE%B0.assets/image-20211107230505637.png)

![image-20211107230645302](%E7%AC%94%E8%AE%B0.assets/image-20211107230645302.png)

# NSURLSession注意

![image-20211107230901207](%E7%AC%94%E8%AE%B0.assets/image-20211107230901207.png)

## 循环引用

强引用

![image-20211107231415067](%E7%AC%94%E8%AE%B0.assets/image-20211107231415067.png)

![image-20211107232136407](%E7%AC%94%E8%AE%B0.assets/image-20211107232136407.png)

使用单例创建的session，无法使用代理，保存在静态存储区，所以不需要销毁
