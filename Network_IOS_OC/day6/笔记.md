# NSURLSession

![image-20211106104138074](%E7%AC%94%E8%AE%B0.assets/image-20211106104138074.png)

- connection运行在当前线程的消息循环中（太底层

想要在子线程运行要把代理设在子线程上，还要专门开启子线程的消息循环

- **Session默认子线程**

- Connection 面向请求 响应

Session 面向任务

## DataTask

![image-20211106105547204](%E7%AC%94%E8%AE%B0.assets/image-20211106105547204.png)

- 默认get请求

## DownloadTask

默认下载到temp，下载完毕自动删除

![image-20211106115209612](%E7%AC%94%E8%AE%B0.assets/image-20211106115209612.png)

- 默认在子线程

- 会自动控制内存 不暴涨

### 下载进度

![image-20211106115400088](%E7%AC%94%E8%AE%B0.assets/image-20211106115400088.png)

![image-20211106222545949](%E7%AC%94%E8%AE%B0.assets/image-20211106222545949.png)

# 压缩/解压缩

![image-20211106223439172](%E7%AC%94%E8%AE%B0.assets/image-20211106223439172.png)

![image-20211106224002410](%E7%AC%94%E8%AE%B0.assets/image-20211106224002410.png)

# WebDav

- 建立在http协议基础上的服务器（文件的服务器

![image-20211107114511618](%E7%AC%94%E8%AE%B0.assets/image-20211107114511618.png)

![image-20211107121439195](%E7%AC%94%E8%AE%B0.assets/image-20211107121439195.png)

上传，删除都需要账户信息

request.HTTPMethod = @"put";来上传

删除：request.HTTPMethod = @"delete";
![image-20211107230505637](%E7%AC%94%E8%AE%B0.assets/image-20211107230505637.png)

![image-20211107230645302](%E7%AC%94%E8%AE%B0.assets/image-20211107230645302.png)

# NSURLSession注意

session使用代理，不能用全局单例对象

![image-20211107230901207](%E7%AC%94%E8%AE%B0.assets/image-20211107230901207.png)

## 循环引用

强引用

![image-20211107231415067](%E7%AC%94%E8%AE%B0.assets/image-20211107231415067.png)

![image-20211107232136407](%E7%AC%94%E8%AE%B0.assets/image-20211107232136407.png)

使用单例创建的session，无法使用代理，保存在静态存储区，所以不需要销毁

# HTTPS

- http层加了一个TLS协议

要求服务器，客户端传递加密了的数据

- Https服务器需要申请证书（公钥 ）

服务器给客户端发送公钥

客户端随机生成私钥，用公钥加密后给服务器

![image-20211108143126310](%E7%AC%94%E8%AE%B0.assets/image-20211108143126310.png)

![image-20211108151148751](%E7%AC%94%E8%AE%B0.assets/image-20211108151148751.png)

![image-20211108144011464](%E7%AC%94%E8%AE%B0.assets/image-20211108144011464.png)

# NSURLSessionConfiguration

![  ](%E7%AC%94%E8%AE%B0.assets/image-20211108145132400.png)

![image-20211108151305212](%E7%AC%94%E8%AE%B0.assets/image-20211108151305212.png)

# AFN

![image-20211108151328700](%E7%AC%94%E8%AE%B0.assets/image-20211108151328700.png)

- reachability判断网络连接

## 监视

![image-20211108204707806](%E7%AC%94%E8%AE%B0.assets/image-20211108204707806.png)

![image-20211108204807108](%E7%AC%94%E8%AE%B0.assets/image-20211108204807108.png)

# Serialization

AFHTTPSessionManager默认JSON反序列化，如果不是JSON反序列化会报错

![image-20211108205651798](%E7%AC%94%E8%AE%B0.assets/image-20211108205651798.png)

![image-20211108205755686](%E7%AC%94%E8%AE%B0.assets/image-20211108205755686.png)

![image-20211108205922036](%E7%AC%94%E8%AE%B0.assets/image-20211108205922036.png)

需要用哪个反序列化用哪个
